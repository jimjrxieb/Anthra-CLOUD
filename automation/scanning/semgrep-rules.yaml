# Semgrep Rules Configuration â€” FedRAMP RA-5 SAST
# Maps to: RA-5 (Vulnerability Scanning)

rules:
  # SQL Injection Detection
  - id: fedramp-sql-injection
    patterns:
      - pattern: |
          $QUERY = "..." . $INPUT . "..."
      - metavariable-regex:
          metavariable: $QUERY
          regex: ".*(SELECT|INSERT|UPDATE|DELETE).*"
    message: >
      SQL injection vulnerability detected. Use parameterized queries.
      FedRAMP Control: RA-5, SI-2
    severity: ERROR
    languages: [php]
    metadata:
      nist: [RA-5, SI-2]
      cwe: CWE-89
      iron-legion-rank: D

  # Command Injection Detection
  - id: fedramp-command-injection
    patterns:
      - pattern-either:
          - pattern: system($INPUT)
          - pattern: exec($INPUT)
          - pattern: shell_exec($INPUT)
          - pattern: passthru($INPUT)
    message: >
      OS command injection vulnerability detected. Sanitize input or use safe alternatives.
      FedRAMP Control: RA-5, SI-2
    severity: ERROR
    languages: [php]
    metadata:
      nist: [RA-5, SI-2]
      cwe: CWE-78
      iron-legion-rank: C

  # Hardcoded Credentials
  - id: fedramp-hardcoded-secret
    pattern-either:
      - pattern: |
          $VAR = "...$PASSWORD..."
      - pattern: |
          password = "..."
    message: >
      Potential hardcoded credential detected. Use environment variables or secrets manager.
      FedRAMP Control: IA-5
    severity: WARNING
    languages: [php, python]
    metadata:
      nist: [IA-5]
      cwe: CWE-798
      iron-legion-rank: B

  # Missing CSRF Protection
  - id: fedramp-missing-csrf
    patterns:
      - pattern: |
          $_POST[...]
      - pattern-not-inside: |
          checkToken(...)
    message: >
      Form processing without CSRF token verification.
      FedRAMP Control: SC-7
    severity: WARNING
    languages: [php]
    metadata:
      nist: [SC-7]
      cwe: CWE-352
      iron-legion-rank: D

  # Unvalidated File Include
  - id: fedramp-file-inclusion
    pattern-either:
      - pattern: include($_GET[...])
      - pattern: include($_POST[...])
      - pattern: require($_GET[...])
      - pattern: require($_POST[...])
    message: >
      File inclusion with user-controlled path. Use allowlist validation.
      FedRAMP Control: AC-3, SI-2
    severity: ERROR
    languages: [php]
    metadata:
      nist: [AC-3, SI-2]
      cwe: CWE-98
      iron-legion-rank: C
